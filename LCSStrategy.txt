Laser Calibration Strategy
==========================
 General Idea: Obtain laser tracks in the full TPC, in this step the true laser path and the corresponding TPC readout(triggered by laser) is stored. Based on this combined dataset a field correction map is generated which is used to correct the position of events recorded later.


1. The laser calibration system hardware
----------------------------------------

2. Obtaining Laser Tracks (Operational mode)
--------------------------------------------
 Two independent laser systems are mounted on each end of the TPC. A table of optimal positions (with respect to speed and shadows due to field cage rings) and laser attenuation is obtained during cold commissioning and stored. During cold commissioning the optimal settings of the motor movement (acceleration, maximal speed, torque, ...) has to be determined as well. As trigger source a signal from a photodiode registering laser pulses is used, the signal is attenuated and connected to a TTL to NIM converter (acting as a discriminator with ns delay) and fed to a logic fan-in-fan out box for distribution. The signal is brought to the TPC readout trigger input and the feedthrough position encoder hardware trigger input.
 In the following a description of the anticipated normal operation sequence is given. The described procedures apply for one single laser system, before no definite plan exist for the final optimal scanning procedure the two identical laser systems can be seen as independent.

 2.1 Hardware Flow
  0. Device initialization - After turn on
   0.1 Laser is warmed up (takes 20 Minutes)
   0.2 Attenuator is moved into position according to table for first shot
   0.3 Aperture position is checked and if necessary repositioned (stays normally fixed)
   0.4 Mirror positions are checked and if necessary repositioned (stays normally fixed)
   0.5 Motor controller is initialized, movement parameters are set
   0.6 Encoder controller is initialized for triggered readout
   0.7 Reference movement (homing) of the two axes is performed
   0.8 Rotary encoder position is initialized (drive trough two reference marks needed), this is connected to previous point
   0.9 Bring cold mirror into position according to the first point 
  
  1. TPC Laser scan (N moves)
   1.1 Initialization completed?
   1.2 Shoot laser
   1.3 Collect laser position -> if valid: continue, if invalid: ???, Check if laser present?
   1.4 Move to next position / laser attenuation in table. Goto 1.2.

  2. Finalize
   2.0 Do we want to shut down the system (or do another run)?
   2.1 Let laser cool down (20 Minutes) ->  shut down laser 
   2.2 Bring encoder controller into default mode (if not made correct: hardware reset necessary!)
   2.3 Shut down laser table devices (attenuator, mirrors, aperture)
   2.4 Remove current (in stop) on motors before full shutdown
   2.5 Shutdown 


 2.2 Data Flow 
  2.1 Photodiode records an laser shot --> Hardware triggers Encoder Controller and TPC readout
  2.2 TPC readout, no idea how this works.
  2.3 Hard Trigger: Current Position is stored in controller and a soft trigger is generated.
  2.4 Server gets the new position via UDP and stores it.
  2.5 The attenuator, aperture and mirror positions are stored when a valid position is available on the server.
  2.6 The positions are collected and sent to the uboone DAQ server synced with the corresponding wire signals. (Run, Event numbers)
 

 > Possible errors: 
  - Lost TPC/UDP package with feedthrough positions
  - No Communication with any of the devices --> need feedback/error handling!



 > Remarks / Open Questions:
 - Network layout, are there two network cards available in the server? Yes: good, No: Need an ip address for encoder controller (anyway better so we can access controller independently)
 - Define interface with uBooNE database for collected dataset by the laser system
 - How are the 
 - (1.) alternating left/right shots or full scan left then right? --> needs timing of the two laser system!
 - (0.4 and 0.3) If once positioned: Can we switch them off and leave them in position?
 - Is there a favored position for the cold mirror when not used?
 - Finite-state machine needed? - According to points in 2.
 - Feedback loop from DAQ (Photodiode, TPC readout) to feedtrough movement needed?
 - (1.3) What is a valid laser position?
 - (1.3) What to do when an invalid laser position is present? Continue until 10 Positions are invalid?
 - Consistency checking of recorded laser positions and reference table positions?
 - How is the consistency between mirror positions and TPC readout checked?? (Timestamp)
 - If Timestamp is used for consistency: How are the devices synchronized?
 - What could be the best movement strategy? - Horizontal scans vs. vertical scans, backlash issue
 - What is the off state of the system? All systems turned off - how is this realized?
 . (0.7/0.8) Best homing strategy - we need a fixed and controlled starting position --> yet no feedback between encoder and motors foreseen/realized!
 - Issue with on/off switching of devices: Are COM ports issued always in the same order?
 - Define the look of the stored positions (integer, float, percentage, angle ...)
 - Higher level control: Indication of start, stop, error etc. of a calibration run
 - low priority: (Set up of an uBooNE independent database of laser runs on our server)


3. User Interface
-----------------

4. Cold Commissioning
-------------------
 > Requirements:
  - TPC event display of a laser shot ~ seconds scale display of the recorded event
  - Intuitive steering of the feedthrough, last mirror, laser energy
  - Graphical representation of the cold mirror with respect ot the TPC